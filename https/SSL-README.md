# 在本地开发环境中使用 HTTPS

为了使地理位置 API 正常工作，您需要在本地开发环境中使用 HTTPS。本文档提供了设置 HTTPS 的步骤。

## 为什么需要 HTTPS？

现代浏览器出于安全考虑，要求某些敏感 API（如地理位置 API）只能在安全上下文中使用。安全上下文包括：

- 通过 HTTPS 提供的页面
- 来自 `localhost` 的页面（某些浏览器）

虽然 `localhost` 在某些浏览器中被视为安全上下文，但为了确保跨浏览器兼容性，建议使用 HTTPS。

## 设置步骤

### 1. 生成自签名 SSL 证书

我们提供了一个脚本来生成自签名 SSL 证书。运行以下命令：

```bash
node https/generate-ssl-cert.js
```

这将在项目根目录下创建一个 `ssl` 文件夹，并在其中生成 `key.pem` 和 `cert.pem` 文件。

### 2. 启动开发服务器

生成证书后，您可以使用以下命令启动开发服务器：

```bash
npm run serve
```

服务器将自动使用 HTTPS 协议启动。

### 3. 处理浏览器安全警告

由于使用的是自签名证书，浏览器会显示安全警告。您需要：

1. 点击"高级"或"详细信息"
2. 点击"继续访问"或"接受风险并继续"

### 4. 授予地理位置权限

现在您的应用运行在 HTTPS 上，浏览器应该会显示地理位置权限请求对话框。点击"允许"以授予权限。

## 手动生成证书（如果脚本失败）

如果自动脚本失败，您可以手动生成证书：

1. 安装 OpenSSL（如果尚未安装）
2. 运行以下命令：

```bash
mkdir -p ssl
openssl req -x509 -newkey rsa:4096 -keyout ssl/key.pem -out ssl/cert.pem -days 365 -nodes -subj "/CN=localhost"
```

3. 将生成的 `key.pem` 和 `cert.pem` 文件放在项目根目录的 `ssl` 文件夹中

## 故障排除

### 证书错误

如果您看到证书错误，可能是因为：

- 证书已过期（默认有效期为 365 天）
- 证书不受信任（这是正常的，因为它是自签名的）

解决方法：删除 `ssl` 文件夹中的文件，然后重新运行生成脚本。

### 地理位置 API 仍然不工作

如果地理位置 API 仍然不工作，请检查：

1. 浏览器控制台是否有错误消息
2. 浏览器的地理位置权限设置
3. 您是否通过 HTTPS URL 访问应用（应该是 `https://localhost:8080`）

## 其他注意事项

- 自签名证书仅适用于本地开发环境
- 在生产环境中，您应该使用由受信任的证书颁发机构颁发的证书
- 某些浏览器可能需要您手动信任自签名证书
