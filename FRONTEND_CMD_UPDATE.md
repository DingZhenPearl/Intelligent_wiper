# å‰ç«¯CMDæ ¼å¼æ›´æ–°è¯´æ˜

## ğŸ“‹ æ›´æ–°ç»“æœ

**å¥½æ¶ˆæ¯ï¼šå‰ç«¯ä»£ç æ— éœ€ä¿®æ”¹ï¼** ğŸ‰

## âœ… ä¸ºä»€ä¹ˆå‰ç«¯ä¸éœ€è¦ä¿®æ”¹ï¼Ÿ

### 1. **APIæ¥å£ä¿æŒä¸å˜**
å‰ç«¯ä»ç„¶è°ƒç”¨ç›¸åŒçš„APIç«¯ç‚¹ï¼š
- `POST /api/wiper/control` - ä¸»è¦æ§åˆ¶æ¥å£
- `POST /api/wiper/api-control` - APIæ§åˆ¶æ¥å£
- `GET /api/wiper/status` - çŠ¶æ€æŸ¥è¯¢æ¥å£

### 2. **è¯·æ±‚æ ¼å¼ä¿æŒä¸å˜**
å‰ç«¯å‘é€çš„è¯·æ±‚ä½“æ ¼å¼å®Œå…¨ç›¸åŒï¼š
```javascript
// wiperService.control(status)
await post('/api/wiper/control', { status: 'low' });

// wiperService.apiControl(command)  
await post('/api/wiper/api-control', { command: 'low' });
```

### 3. **å“åº”æ ¼å¼ä¿æŒä¸å˜**
åç«¯è¿”å›çš„å“åº”æ ¼å¼å®Œå…¨ç›¸åŒï¼š
```json
{
  "success": true,
  "status": "low"
}
```

## ğŸ”§ åç«¯çš„å˜åŒ–ï¼ˆå¯¹å‰ç«¯é€æ˜ï¼‰

### ä¿®æ”¹çš„æ–‡ä»¶
- `python/onenet_mqtt_control.py` - æ›´æ–°ä¸ºæ”¯æŒCMDæ ¼å¼

### ä¸»è¦å˜åŒ–
1. **MQTTä¸»é¢˜æ ¼å¼**ï¼šä» `thing.property.set` æ›´æ–°ä¸º `cmd/request/{cmdid}`
2. **æ¶ˆæ¯æ ¼å¼**ï¼šä»å¤æ‚çš„åµŒå¥—ç»“æ„ç®€åŒ–ä¸ºç›´æ¥çš„é”®å€¼å¯¹
3. **å›å¤æœºåˆ¶**ï¼šæ”¯æŒCMDæ ¼å¼çš„å›å¤ç¡®è®¤

### å…¼å®¹æ€§ä¿è¯
- ä¿æŒäº†æ—§æ ¼å¼çš„å…¼å®¹æ€§
- å‰ç«¯APIè°ƒç”¨è·¯å¾„å®Œå…¨ä¸å˜
- å“åº”æ•°æ®ç»“æ„å®Œå…¨ä¸å˜

## ğŸ¯ å‰ç«¯ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹

### Homeé¡µé¢æ§åˆ¶æŒ‰é’®
```vue
<!-- è¿™äº›ä»£ç å®Œå…¨ä¸éœ€è¦ä¿®æ”¹ -->
<li @click="changeStatus('low')">ä½é€Ÿ</li>
<li @click="changeStatus('high')">é«˜é€Ÿ</li>

<script>
const changeStatus = async (status) => {
  // è¿™ä¸ªè°ƒç”¨å®Œå…¨ä¸éœ€è¦ä¿®æ”¹
  const result = await wiperService.control(status);
  // å¤„ç†ç»“æœçš„ä»£ç ä¹Ÿä¸éœ€è¦ä¿®æ”¹
}
</script>
```

### wiperServiceæœåŠ¡
```javascript
// è¿™äº›ä»£ç å®Œå…¨ä¸éœ€è¦ä¿®æ”¹
async control(status) {
  const response = await post('/api/wiper/control', { status });
  const data = await response.json();
  return data;
}

async apiControl(command) {
  const response = await post('/api/wiper/api-control', { command });
  const data = await response.json();
  return data;
}
```

## ğŸš€ æµ‹è¯•éªŒè¯

### åç«¯æµ‹è¯•ç»“æœ
```bash
# ç›´æ¥æµ‹è¯•Pythonè„šæœ¬
python onenet_mqtt_control.py --action control --status low --username admin

# ç»“æœï¼šâœ… æˆåŠŸ
LOG: æˆåŠŸè¿æ¥åˆ°MQTTæœåŠ¡å™¨: mqtts.heclouds.com
LOG: å·²è®¢é˜…å‘½ä»¤è¯·æ±‚ä¸»é¢˜ï¼ˆé€šé…ç¬¦ï¼‰: $sys/66eIb47012/test/cmd/request/+
LOG: æ‰§è¡Œé›¨åˆ·æ§åˆ¶: low
{"success": true, "status": "low"}
```

### å‰ç«¯æµ‹è¯•å»ºè®®
1. æ‰“å¼€å‰ç«¯åº”ç”¨
2. ç™»å½•ä»»æ„ç”¨æˆ·è´¦å·
3. åœ¨é¦–é¡µç‚¹å‡»é›¨åˆ·æ§åˆ¶æŒ‰é’®
4. è§‚å¯Ÿæ§åˆ¶æ˜¯å¦æ­£å¸¸å·¥ä½œ
5. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

## ğŸ“Š æ€»ç»“

| ç»„ä»¶ | æ˜¯å¦éœ€è¦ä¿®æ”¹ | è¯´æ˜ |
|------|-------------|------|
| å‰ç«¯Vueç»„ä»¶ | âŒ ä¸éœ€è¦ | APIè°ƒç”¨æ–¹å¼ä¸å˜ |
| wiperService | âŒ ä¸éœ€è¦ | æ¥å£å®šä¹‰ä¸å˜ |
| åç«¯è·¯ç”± | âŒ ä¸éœ€è¦ | ç«¯ç‚¹å’Œå‚æ•°ä¸å˜ |
| Pythonè„šæœ¬ | âœ… å·²ä¿®æ”¹ | æ›´æ–°ä¸ºCMDæ ¼å¼ |
| MQTTé€šä¿¡ | âœ… å·²æ›´æ–° | ä½¿ç”¨æ–°çš„ä¸»é¢˜æ ¼å¼ |

## ğŸ‰ ç»“è®º

**å‰ç«¯å¼€å‘è€…æ— éœ€åšä»»ä½•ä¿®æ”¹ï¼** 

æ‰€æœ‰çš„æ›´æ–°éƒ½åœ¨åç«¯Pythonè„šæœ¬å±‚é¢å®Œæˆï¼Œå‰ç«¯çš„APIè°ƒç”¨ã€æ•°æ®æ ¼å¼ã€ç”¨æˆ·ç•Œé¢éƒ½ä¿æŒå®Œå…¨ä¸å˜ã€‚è¿™æ˜¯ä¸€ä¸ªå®Œç¾çš„å‘åå…¼å®¹æ›´æ–°ã€‚

ç”¨æˆ·å¯ä»¥ç»§ç»­æ­£å¸¸ä½¿ç”¨å‰ç«¯ç•Œé¢æ§åˆ¶é›¨åˆ·ï¼Œåº•å±‚å·²ç»è‡ªåŠ¨åˆ‡æ¢åˆ°OneNETå¹³å°æ¨èçš„CMDæ ¼å¼ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œå…¼å®¹æ€§ã€‚
